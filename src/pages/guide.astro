---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
---

<!doctype html>
<html lang="zh-cn">
	<head>
		<BaseHead title={`æ·±åº¦æ¢ç´¢ | ${SITE_TITLE}`} description="åŸºäºå…«æœ¨ä»å¹³ä¸è€é«˜ç†è®ºçš„æ·±åº¦äººç”Ÿè§£æ" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
        
        <!-- å¼•å…¥ Tailwind CSS (ä¸ºäº†é…åˆä½ æä¾›çš„ä»£ç é£æ ¼) -->
        <script src="https://cdn.staticfile.net/tailwindcss/3.3.5/tailwind.min.js"></script>
        
		<style is:inline>
            /* === åŸºç¡€å¸ƒå±€ä¿®æ­£ === */
            html, body { margin: 0; padding: 0; width: 100%; overflow-x: hidden; background-color: #fdfbf7; }
            
            /* === ä½ æä¾›çš„åŸç”Ÿæ ·å¼ === */
            .fade-in { animation: fadeIn 0.6s ease-out; }
            @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            textarea { resize: vertical; }
            .circle-card { transition: all 0.3s; }
            .circle-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
            ::-webkit-scrollbar { width: 6px; }
            ::-webkit-scrollbar-track { background: #f1f1f1; }
            ::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 3px; }
            .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px); }
            .modal-content { animation: popIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
            @keyframes popIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

            /* ä¿®å¤ Header é®æŒ¡é—®é¢˜ */
            .main-wrapper {
                padding-top: 20px;
                padding-bottom: 20px;
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: flex-start;
            }
		</style>
	</head>
	<body class="font-sans text-stone-800">

        <!-- è¿™é‡Œçš„ fixed-bg ä¿ç•™ï¼Œä¿æŒå…¨ç«™é£æ ¼ç»Ÿä¸€ -->
        <div style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; background: url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?q=80&w=1200&auto=format&fit=crop') no-repeat center center; background-size: cover; opacity: 0.3;"></div>

        <div class="main-wrapper px-4">
            <div class="max-w-3xl w-full bg-white/95 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden border border-stone-200 flex flex-col" style="min-height: 85vh;">
                
                <!-- é¡¶éƒ¨è¿›åº¦æ¡ -->
                <div class="w-full bg-stone-100 h-2">
                    <div id="progress-bar" class="bg-stone-800 h-2 transition-all duration-500" style="width: 0%"></div>
                </div>

                <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
                <div class="p-6 border-b border-stone-100 bg-white/80 sticky top-0 z-30 shadow-sm flex justify-between items-center">
                    <div>
                        <a href="/" class="text-xl font-bold text-stone-800 tracking-tight hover:text-blue-600 transition">â† äººç”Ÿä½¿ç”¨è¯´æ˜ä¹¦</a>
                        <p class="text-xs text-stone-500 mt-1 font-mono">LOGIC KERNEL: LAO GAO & YAGI JIMPEI</p>
                    </div>
                    <div class="flex gap-1">
                        <div class="w-3 h-3 rounded-full bg-red-400"></div>
                        <div class="w-3 h-3 rounded-full bg-blue-400"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                    </div>
                </div>

                <!-- æ ¸å¿ƒå†…å®¹æ»šåŠ¨åŒº -->
                <div id="app" class="flex-1 p-6 overflow-y-auto pb-20 scroll-smooth relative">
                    
                    <!-- SCREEN 0: æ¬¢è¿/å¼€å§‹ -->
                    <div id="step-0" class="fade-in h-full flex flex-col justify-center items-center text-center space-y-8 py-12">
                        <div class="relative">
                            <div class="text-7xl">ğŸ§¬</div>
                            <div class="absolute -bottom-2 -right-2 text-2xl">ğŸ—ï¸</div>
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold text-stone-800 mb-3">å¯»æ‰¾å‡ºå‚è®¾ç½®</h2>
                            <p class="text-stone-500 text-sm leading-relaxed max-w-md mx-auto">
                                æˆ‘ä»¬å°†é€šè¿‡ 16 ä¸ªæ½œæ„è¯†æ¢é’ˆï¼Œ<br>
                                æå–ä½ çš„<span class="text-red-500 font-bold">ä»·å€¼è§‚</span>ã€<span class="text-blue-500 font-bold">æ‰èƒ½</span>ä¸<span class="text-yellow-500 font-bold">çƒ­æƒ…</span>ã€‚<br>
                                æœ€åç”Ÿæˆç‹¬å±äºä½ çš„â€œäººç”Ÿå…¬å¼â€ã€‚
                            </p>
                        </div>
                        <div class="w-full max-w-xs space-y-4">
                            <input type="text" id="user-name" placeholder="è¯·è¾“å…¥ä½ çš„åå­—" class="w-full p-4 bg-stone-50 border border-stone-200 rounded-xl text-center focus:border-stone-800 outline-none transition font-bold text-lg">
                            <button onclick="start()" class="w-full bg-stone-800 text-white py-4 rounded-xl hover:bg-stone-900 transition font-bold shadow-lg text-lg tracking-wide">å¼€å§‹è§£æ</button>
                        </div>
                    </div>

                    <!-- SCREEN 1: é—®é¢˜è¡¨å• -->
                    <div id="form-container" class="hidden fade-in">
                        <div class="flex items-center gap-3 mb-8">
                            <span id="chapter-badge" class="bg-stone-800 text-white px-3 py-1 rounded text-xs font-bold tracking-wider">PART 1</span>
                            <div>
                                <h2 id="chapter-title" class="text-2xl font-bold text-stone-800"></h2>
                                <p id="section-desc" class="text-sm text-stone-500 mt-1"></p>
                            </div>
                        </div>
                        <div id="questions-list" class="space-y-12"></div>
                    </div>

                    <!-- SCREEN 2: åŠ è½½åŠ¨ç”» -->
                    <div id="loading-screen" class="hidden h-full flex flex-col justify-center items-center text-center fade-in py-20">
                        <div class="animate-spin text-5xl mb-6">â³</div>
                        <h3 class="text-2xl font-bold text-stone-800">æ­£åœ¨è¿æ¥æ½œæ„è¯†...</h3>
                        <div class="text-stone-500 text-sm mt-4 space-y-2 font-mono text-left inline-block">
                            <p>Step 1: æå–å…³é”®è¯ï¼ˆå¯»æ‰¾é‡å¤é¡¹ï¼‰...</p>
                            <p>Step 2: å¡«å…¥ä¸‰åœ†åœˆï¼ˆä»·å€¼è§‚/æ‰èƒ½/çƒ­æƒ…ï¼‰...</p>
                            <p>Step 3: ç»„åˆäººç”Ÿå…¬å¼ï¼ˆé€ å¥ï¼‰...</p>
                            <p>Step 4: åŒ¹é…ç°å®è½½ä½“ï¼ˆèŒä¸šï¼‰...</p>
                        </div>
                    </div>

                    <!-- SCREEN 3: ç»“æœå±•ç¤º -->
                    <div id="result-screen" class="hidden fade-in space-y-10 pb-10">
                        <div class="text-center border-b border-stone-100 pb-6">
                            <h2 class="text-3xl font-bold text-stone-800">åˆ†ææŠ¥å‘Š</h2>
                            <p class="text-stone-500 text-sm mt-2">å—æµ‹è€…: <span id="res-name" class="font-bold text-black text-lg"></span></p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="circle-card bg-red-50 p-5 rounded-2xl border border-red-100 text-center flex flex-col justify-between">
                                <div class="text-xs font-black text-red-400 mb-2 tracking-widest uppercase">VALUES (æŒ‡å—é’ˆ)</div>
                                <div id="kw-values" class="text-lg font-bold text-red-900 leading-snug">...</div>
                                <div class="text-[10px] text-red-300 mt-2">ä½ çš„ç†æƒ³çŠ¶æ€</div>
                            </div>
                            <div class="circle-card bg-blue-50 p-5 rounded-2xl border border-blue-100 text-center flex flex-col justify-between">
                                <div class="text-xs font-black text-blue-400 mb-2 tracking-widest uppercase">TALENTS (æ‰‹æ®µ)</div>
                                <div id="kw-talents" class="text-lg font-bold text-blue-900 leading-snug">...</div>
                                <div class="text-[10px] text-blue-300 mt-2">ä½ çš„æ— æ„è¯†ä¹ æƒ¯</div>
                            </div>
                            <div class="circle-card bg-yellow-50 p-5 rounded-2xl border border-yellow-100 text-center flex flex-col justify-between">
                                <div class="text-xs font-black text-yellow-600 mb-2 tracking-widest uppercase">PASSION (é¢†åŸŸ)</div>
                                <div id="kw-passion" class="text-lg font-bold text-yellow-900 leading-snug">...</div>
                                <div class="text-[10px] text-yellow-500 mt-2">ä½ æ„¿æ„æŠ•å…¥çš„åœ°æ–¹</div>
                            </div>
                        </div>
                        <div class="bg-stone-900 text-white p-8 rounded-3xl shadow-xl relative overflow-hidden">
                            <div class="absolute top-0 right-0 text-8xl opacity-10 select-none">âš¡</div>
                            <h3 class="text-center text-stone-400 text-xs font-bold tracking-widest uppercase mb-6">YOUR LIFE FORMULA</h3>
                            <div class="text-center space-y-6">
                                <p class="text-lg md:text-xl leading-relaxed font-light text-stone-300">æˆ‘æƒ³åœ¨ <span id="f-passion" class="text-yellow-400 font-bold border-b border-yellow-400/30 pb-1"></span> çš„é¢†åŸŸ</p>
                                <p class="text-lg md:text-xl leading-relaxed font-light text-stone-300">åˆ©ç”¨æˆ‘çš„ <span id="f-talent" class="text-blue-400 font-bold border-b border-blue-400/30 pb-1"></span></p>
                                <p class="text-2xl md:text-3xl leading-relaxed font-bold text-white mt-4">å»å®ç° <span id="f-value" class="text-red-500 bg-white/10 px-3 py-1 rounded-lg"></span></p>
                            </div>
                        </div>
                        <div class="bg-white border border-stone-200 p-6 rounded-2xl">
                            <h3 class="font-bold text-stone-800 mb-4 flex items-center gap-2"><span class="text-xl">ğŸ’¼</span> ç°å®èŒä¸šè½½ä½“ (åŒ¹é…ç»“æœ)</h3>
                            <p id="res-advice" class="text-sm text-stone-600 leading-loose whitespace-pre-line"></p>
                        </div>
                        <button onclick="location.reload()" class="w-full py-4 bg-stone-50 border border-stone-200 rounded-xl text-stone-500 text-sm hover:bg-stone-100 hover:text-stone-800 transition font-bold">é‡æ–°æµ‹è¯•</button>
                    </div>
                </div>

                <!-- åº•éƒ¨å¯¼èˆªæ  -->
                <div id="footer-nav" class="hidden p-4 border-t border-stone-100 bg-white/90 sticky bottom-0 z-20 flex gap-3">
                    <button onclick="prevSection()" id="prev-btn" class="flex-1 bg-white border border-stone-200 text-stone-600 py-3 rounded-xl hover:bg-stone-50 transition font-bold disabled:opacity-50">â† ä¸Šä¸€æ­¥</button>
                    <button onclick="nextSection()" id="next-btn" class="flex-[2] bg-stone-800 text-white py-3 rounded-xl hover:bg-stone-700 transition font-bold shadow-lg">ä¸‹ä¸€æ­¥ â†’</button>
                </div>

                <!-- å¼¹çª—: é”¦å›Š/AIå»ºè®® -->
                <div id="hint-modal" class="fixed inset-0 z-50 hidden modal-backdrop flex items-center justify-center px-4">
                    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col modal-content max-h-[80vh]">
                        <div class="p-6 border-b border-stone-100 flex justify-between items-center sticky top-0 bg-stone-50">
                            <h3 class="text-lg font-bold text-stone-800 flex items-center gap-2"><span>ğŸ’¡</span> æ€è·¯é”¦å›Š</h3>
                            <button onclick="closeHint()" class="text-stone-400 hover:text-stone-800 text-2xl leading-none">&times;</button>
                        </div>
                        <div class="p-6 overflow-y-auto space-y-6 text-sm text-stone-600 leading-relaxed">
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                                <h4 class="font-bold text-yellow-700 mb-2 text-xs uppercase tracking-wider">è€é«˜æ ¸å¿ƒè¯­å½•</h4>
                                <p id="modal-intent" class="text-yellow-900"></p>
                            </div>
                            <div>
                                <h4 class="font-bold text-stone-800 mb-2 text-xs uppercase tracking-wider">ğŸ¯ å¼•å¯¼å®æ“</h4>
                                <p id="modal-guide" class="whitespace-pre-line"></p>
                            </div>
                            <div id="modal-ai-section" class="hidden border-t border-stone-100 pt-4">
                                <h4 class="font-bold text-blue-600 mb-2 text-xs uppercase tracking-wider flex items-center gap-1"><span>ğŸ¤–</span> AI è¡¥å……å»ºè®®</h4>
                                <p id="modal-ai-content" class="text-stone-700 whitespace-pre-line"></p>
                            </div>
                        </div>
                        <div class="p-4 border-t border-stone-100 bg-stone-50 text-center">
                            <button onclick="closeHint()" class="bg-stone-800 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-stone-700 transition w-full">æˆ‘æ˜ç™½äº†</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <script is:inline>
            // ============================================================
            // âš ï¸ å…³é”®é…ç½®ï¼šè¯·å°†æ­¤å¤„æ›¿æ¢ä¸ºä½ ç»‘å®šçš„ API åŸŸå
            // ä¾‹å¦‚: "https://api.mylaogao.top"
            // ============================================================
            const API_URL = "https://api.mylaogao.top"; 

            function cleanText(text) {
                if (!text) return "";
                return text.replace(/<br\s*\/?>/gi, '\n').replace(/<\/li>/gi, '\n').replace(/<li>/gi, 'â€¢ ').replace(/<[^>]+>/g, '').replace(/^\s*[\-\*]\s+/gm, 'â€¢ ').trim();
            }
            function openHint(title, contentData) {
                document.getElementById('hint-modal').classList.remove('hidden');
                document.getElementById('modal-intent').innerText = cleanText(contentData.intent);
                document.getElementById('modal-guide').innerText = cleanText(contentData.guide);
                const aiSection = document.getElementById('modal-ai-section');
                if (contentData.aiContent) {
                    aiSection.classList.remove('hidden');
                    document.getElementById('modal-ai-content').innerText = cleanText(contentData.aiContent);
                } else { aiSection.classList.add('hidden'); }
            }
            function closeHint() { document.getElementById('hint-modal').classList.add('hidden'); }

            const chapters = [
                {
                    id: "values", name: "ä»·å€¼è§‚ (Values)", desc: "æ ¸å¿ƒï¼šä½ æœ€çœ‹é‡ä»€ä¹ˆï¼Ÿ(ç”¨ç›´è§‰ï¼Œä¸è¦æ€è€ƒ)",
                    questions: [
                        { q: "1. ä½ å°Šæ•¬çš„äººæ˜¯è°ï¼Ÿ(â˜… èµ·ç‚¹é—®é¢˜)", intent: "ä¸è¦æƒ³å¤ªä¹…ï¼Œç›´è§‰æ˜¯è°å°±æ˜¯è°ã€‚èŒƒå›´æ— é™å®½ã€‚", guide: "åˆ«ç­›é€‰ï¼Œåˆ«ç®¡é‚£ä¸ªäººå¤Ÿä¸å¤Ÿä¼Ÿå¤§ã€‚æ­¤æ—¶æ­¤åˆ»ä½ è„‘å­é‡Œè¹¦å‡ºæ¥çš„ç¬¬ä¸€ä¸ªåå­—æ˜¯è°ï¼Ÿ" },
                        { q: "2. ä¸ºä»€ä¹ˆå°Šæ•¬ä»–ï¼Ÿ/ å–œæ¬¢ä»–ä»€ä¹ˆåœ°æ–¹ï¼Ÿ", intent: "åå­—ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯â€˜ä¸ºä»€ä¹ˆâ€™ã€‚è¿™äº›å½¢å®¹è¯ï¼ˆå…³é”®è¯ï¼‰ï¼Œæ‰æ˜¯ä½ çœŸæ­£çš„ä»·å€¼è§‚ã€‚", guide: "å…·ä½“ç‚¹ï¼Œä»–å“ªä¸€ç‚¹æ‰“åŠ¨äº†ä½ ï¼Ÿæ˜¯ä»–æ‰“ç ´äº†è§„åˆ™ï¼Ÿè¿˜æ˜¯ä»–ç‰¹åˆ«æ¸©æŸ”ï¼Ÿ" },
                        { q: "3. é’æ˜¥æœŸå¯¹ä½ å½±å“å¾ˆå¤§çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ", intent: "å›æƒ³åˆä¸­ã€é«˜ä¸­æ—¶æœŸï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆäº‹å¯¹ä½ çš„ä¸–ç•Œè§‚äº§ç”Ÿäº†å·¨å¤§å†²å‡»ï¼Ÿ", guide: "é‚£æ—¶å€™æœ‰æ²¡æœ‰è®©ä½ è§‰å¾—ç‰¹åˆ«ä¸å…¬å¹³çš„äº‹ï¼Ÿæˆ–è€…è®©ä½ ç¬é—´è§‰å¾—â€˜æˆ‘å°±è¦è¿™æ ·æ´»â€™çš„æ—¶åˆ»ï¼Ÿ" },
                        { q: "4. ä½ è§‰å¾—ç°åœ¨ç¤¾ä¼šæœ‰ä»€ä¹ˆä¸è¶³çš„åœ°æ–¹ï¼Ÿ", intent: "ä½ è§‰å¾—è¿™ä¸ªç¤¾ä¼šç¼ºä»€ä¹ˆï¼Ÿ", guide: "å¦‚æœä½ æœ‰é­”æ³•èƒ½æ”¹å˜ç¤¾ä¼šçš„ä¸€ä¸ªç°çŠ¶ï¼Œä½ ä¼šæ”¹ä»€ä¹ˆï¼Ÿ" },
                        { q: "5. åœ¨æœ‹å‹çœ¼é‡Œä½ æ˜¯ä¸€ä¸ªçœ‹ä¸­ä»€ä¹ˆä¸œè¥¿çš„äººï¼Ÿ", intent: "è¿™ä¸€é¢˜ï¼Œå¿…é¡»å»é—®åˆ«äººã€‚", guide: "ã€å¼ºåˆ¶æ‰§è¡Œã€‘æ‹¿å‡ºæ‰‹æœºï¼Œç°åœ¨å‘ç»™ä¸‰ä¸ªæ­»å…šï¼šâ€˜ä½ è§‰å¾—æˆ‘æœ€çœ‹é‡ä»€ä¹ˆï¼Ÿâ€™" },
                        { q: "6. ç»™èº«è¾¹äººçš„å»ºè®®ï¼Ÿ/ ä¸å¸Œæœ›æœ‹å‹ç»™ä½ ä»€ä¹ˆæ ·çš„å»ºè®®ï¼Ÿ", intent: "ä½ ç»å¸¸æŒ‚åœ¨å˜´è¾¹åŠåˆ«äººçš„è¯æ˜¯ä»€ä¹ˆï¼Ÿ", guide: "ä½ æ˜¯ä¸æ˜¯æ€»å¿ä¸ä½æƒ³çº æ­£åˆ«äººæŸç§æ¯›ç—…ï¼Ÿ" }
                    ]
                },
                {
                    id: "talents", name: "æ‰èƒ½ (Talents)", desc: "æ ¸å¿ƒï¼šä½ è§‰å¾—ç®€å•è€Œåˆ«äººè§‰å¾—éš¾çš„äº‹",
                    questions: [
                        { q: "7. ç›®å‰äººç”Ÿæœ€å……å®çš„ç»å†æ˜¯ä»€ä¹ˆï¼Ÿ", intent: "å“ªä¸€æ®µæ—¶é—´ä½ è§‰å¾—è¿‡å¾—ç‰¹åˆ«å¿«ï¼Ÿ", guide: "ä»€ä¹ˆæ—¶å€™ä½ åšäº‹æƒ…ä¼šå¿˜è®°çœ‹æ‰‹æœºï¼Œå¿˜è®°åƒé¥­ï¼Ÿ" },
                        { q: "8. æœ€è¿‘ä¸€æ¬¡æ„Ÿåˆ°â€œä¸è€çƒ¦â€çš„äº‹æƒ…ï¼Ÿ(â˜…æŒ–æ˜å¤©èµ‹å…³é”®é¢˜)", intent: "ä½ çœ‹è§è°åšäº‹ç¬¨æ‰‹ç¬¨è„šçš„ï¼Œè®©ä½ å¾ˆç«å¤§ï¼Ÿä½ è§‰å¾—ç®€å•ä½†ä»–åšä¸å¥½çš„é‚£ä¸ªäº‹ï¼Œå°±æ˜¯ä½ çš„æ‰èƒ½ã€‚", guide: "å…·ä½“æ˜¯å“ªä¸ªç¯èŠ‚è®©ä½ çœ‹ä¸ä¸‹å»ï¼Ÿ" },
                        { q: "9. é—®é—®èº«è¾¹çš„äººï¼Œä»–ä»¬è§‰å¾—ä½ æ“…é•¿ä»€ä¹ˆï¼Ÿ", intent: "æ‰èƒ½æ˜¯æ— æ„è¯†çš„ï¼Œé—®åˆ«äººã€‚", guide: "åˆ«äººæœ€å¸¸å¤¸ä½ çš„ä¸€å¥è¯æ˜¯ä»€ä¹ˆï¼Ÿ æ˜¯â€˜ä½ çœŸç»†å¿ƒâ€™è¿˜æ˜¯â€˜ä½ ç‚¹å­çœŸå¤šâ€™ï¼Ÿ" },
                        { q: "10. å¦‚æœæ”¾å¼ƒç°åœ¨çš„å·¥ä½œï¼Œä½ ç‰¹åˆ«æƒ³åšçš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ", intent: "å¦‚æœæ²¡æœ‰é’±çš„é—®é¢˜ï¼Œä½ æœ¬èƒ½åœ°æƒ³å»å¹²ä»€ä¹ˆï¼Ÿ", guide: "å‡è®¾ä½ ä¸­äº†å½©ç¥¨ï¼Œç©è…»äº†ä¹‹åï¼Œä½ æ¯å¤©æ—©ä¸Šèµ·æ¥æƒ³å»ç¢ç£¨ç‚¹ä»€ä¹ˆäº‹ï¼Ÿ" },
                        { q: "11. ç›®å‰ä¸ºæ­¢ä½ åšè¿‡æœ€æˆåŠŸçš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ", intent: "å°äº‹ä¹Ÿè¡Œï¼Œåªè¦æ˜¯æœ‰äº†ç»“æœçš„äº‹æƒ…ã€‚", guide: "ä»å°åˆ°å¤§ï¼Œå“ªä»¶äº‹åšå®Œè®©ä½ è§‰å¾—è‡ªå·±â€˜æŒºè¡Œâ€™çš„ï¼Ÿ" }
                    ]
                },
                {
                    id: "passion", name: "æ„¿æœ›å’Œæ¢¦æƒ³ (Passion)", desc: "æ ¸å¿ƒï¼šçœŸçˆ±æ˜¯æ„¿æ„ä»˜å‡ºä»£ä»·çš„",
                    questions: [
                        { q: "12. ä»€ä¹ˆäº‹æƒ…å°±ç®—èŠ±é’±ä½ ä¹Ÿæ„¿æ„å»å­¦ï¼Ÿ", intent: "çœŸçš„çƒ­æƒ…æ˜¯éœ€è¦èŠ±ä»£ä»·çš„ã€‚", guide: "ä½ ç¬¬ä¸€ååº”æ˜¯å»æŠ¥ä¸ªä»€ä¹ˆç­ï¼Ÿ" },
                        { q: "13. ä½ çš„ä¹¦æ¶ä¸Š(æˆ–æµè§ˆè®°å½•)æœ‰ä»€ä¹ˆå†…å®¹çš„ä¹¦ï¼Ÿ", intent: "é‚£äº›ä½ â€˜ä¹°å›æ¥â€™çš„ä¿¡æ¯ï¼Œæš´éœ²äº†ä½ çœŸæ­£çš„å¥½å¥‡å¿ƒã€‚", guide: "æ‰“å¼€ä½ çš„è´­ç‰©è½¯ä»¶æˆ–è§†é¢‘APPï¼Œä½ å…³æ³¨æœ€å¤šçš„é‚£ä¸ªåˆ†ç±»æ˜¯ä»€ä¹ˆï¼Ÿ" },
                        { q: "14. ä»€ä¹ˆå†…å®¹/çŸ¥è¯†æ›¾ç»ç»™ä½ å¾ˆå¤§çš„å¸®åŠ©ï¼Ÿ", intent: "åœ¨ä½ äººç”Ÿä½è°·çš„æ—¶å€™æ•‘è¿‡ä½ ï¼Ÿ", guide: "å¦‚æœä½ çš„æˆ¿å­ç€ç«äº†ï¼Œè®°å¿†é‡Œåªèƒ½ä¿ç•™ä¸€æœ¬ä¹¦æˆ–ä¸€éƒ¨ç”µå½±çš„å†…å®¹ï¼Œä½ ä¼šé€‰å“ªä¸ªï¼Ÿ" },
                        { q: "15. ä½ æœ‰æƒ³è¦æ„Ÿè°¢çš„äººå’Œäº‹ä¹ˆï¼Ÿ", intent: "é‚£ä¸ªè®©ä½ äº§ç”Ÿæ„Ÿæ¿€ä¹‹æƒ…çš„æºå¤´ï¼Œé€šå¸¸è¿ç€ä½ çš„çƒ­æƒ…ã€‚", guide: "é—­ä¸Šçœ¼ç›ï¼Œè°çš„å¸®åŠ©è®©ä½ ç°åœ¨æƒ³èµ·æ¥è¿˜å¿ƒé‡Œæš–æš–çš„ï¼Ÿ" },
                        { q: "16. ä½ å¯¹è¿™ä¸ªä¸–ç•Œæœ‰ä»€ä¹ˆä¸æ»¡ä¹ˆï¼Ÿ", intent: "ä½ å¸Œæœ›è¿™ä¸ªä¸–ç•Œå“ªé‡Œå˜å¾—æ›´å¥½ï¼Ÿ", guide: "å¦‚æœæ˜¯ç¥ï¼Œä½ æœ€æƒ³æ¶ˆç­ä¸–ç•Œä¸Šçš„ä»€ä¹ˆä¸œè¥¿ï¼Ÿ" }
                    ]
                }
            ];

            let currentSectionIdx = 0;
            let userName = "";
            let userAnswers = {};
            chapters.forEach(c => { userAnswers[c.id] = new Array(c.questions.length).fill(""); });

            function start() {
                const name = document.getElementById('user-name').value.trim();
                if (!name) return alert("è¯·å…ˆè¾“å…¥ä½ çš„åå­—");
                userName = name;
                document.getElementById('step-0').classList.add('hidden');
                document.getElementById('form-container').classList.remove('hidden');
                document.getElementById('footer-nav').classList.remove('hidden');
                document.getElementById('footer-nav').classList.add('flex');
                renderSection();
            }

            function renderSection() {
                const section = chapters[currentSectionIdx];
                const container = document.getElementById('questions-list');
                container.innerHTML = ""; 
                document.getElementById('chapter-badge').innerText = `PART ${currentSectionIdx + 1}`;
                document.getElementById('chapter-title').innerText = section.name;
                document.getElementById('section-desc').innerText = section.desc;
                document.getElementById('progress-bar').style.width = `${((currentSectionIdx) / 3) * 100}%`;
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                prevBtn.style.display = (currentSectionIdx === 0) ? 'none' : 'block';
                nextBtn.innerText = (currentSectionIdx === chapters.length - 1) ? "âœ¨ ç”Ÿæˆåˆ†ææŠ¥å‘Š" : "ä¸‹ä¸€æ­¥ â†’";

                section.questions.forEach((item, idx) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = "bg-stone-50 p-6 rounded-xl border border-stone-100 relative group hover:shadow-md transition duration-300";
                    const savedValue = userAnswers[section.id][idx] || "";
                    wrapper.innerHTML = `
                        <div class="mb-3"><label class="block text-base font-bold text-stone-800">${item.q}</label></div>
                        <textarea id="input-${idx}" rows="3" class="w-full bg-white p-4 border border-stone-200 rounded-lg focus:ring-2 focus:ring-stone-800 focus:border-transparent outline-none transition text-sm text-stone-800 leading-relaxed" placeholder="è¯·å‡­ç›´è§‰å›ç­”..." onblur="saveSingleInput(${idx})">${savedValue}</textarea>
                        <div class="flex flex-wrap justify-end gap-2 mt-3">
                            <button onclick="handleHint(${idx})" class="text-xs flex items-center gap-1 px-3 py-1.5 bg-white border border-stone-200 rounded-full text-stone-500 hover:text-stone-900 hover:border-stone-400 transition shadow-sm"><span>ğŸ¤–</span> é—®é—®AIæ€ä¹ˆå†™</button>
                            <button onclick="handleRefine(${idx})" class="text-xs flex items-center gap-1 px-3 py-1.5 bg-white border border-stone-200 rounded-full text-stone-500 hover:text-blue-600 hover:border-blue-200 transition shadow-sm"><span>âœ¨</span> å¸®æˆ‘æ¶¦è‰²</button>
                        </div>`;
                    container.appendChild(wrapper);
                });
                document.getElementById('app').scrollTo(0,0);
            }

            function saveSingleInput(idx) { userAnswers[chapters[currentSectionIdx].id][idx] = document.getElementById(`input-${idx}`).value; }
            
            function saveCurrentInputs() {
                const sectionId = chapters[currentSectionIdx].id;
                const inputs = document.querySelectorAll('#questions-list textarea');
                inputs.forEach((input, idx) => { userAnswers[sectionId][idx] = input.value.trim(); });
                return Array.from(inputs).some(input => input.value.trim() !== "");
            }

            function prevSection() { saveCurrentInputs(); if (currentSectionIdx > 0) { currentSectionIdx--; renderSection(); } }
            
            async function nextSection() {
                if (!saveCurrentInputs()) return alert("è¿™ä¸€é¡µå¥½åƒå…¨æ˜¯ç©ºçš„ï¼Ÿè¯·è‡³å°‘å›ç­”ä¸€ä¸ªé—®é¢˜å§ã€‚");
                if (currentSectionIdx < chapters.length - 1) { 
                    currentSectionIdx++; renderSection(); 
                } else { 
                    document.getElementById('progress-bar').style.width = "100%"; 
                    await submitData(); 
                }
            }

            async function handleHint(idx) {
                const btn = event.currentTarget;
                const originalHtml = btn.innerHTML;
                btn.innerHTML = `<span class="animate-spin">â³</span> ç¿»é˜…è¯´æ˜ä¹¦...`;
                const section = chapters[currentSectionIdx];
                const qData = section.questions[idx];
                
                try {
                    const res = await fetch(API_URL, {
                        method: "POST", headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ 
                            action: 'hint', 
                            context: section.name, 
                            data: { 
                                question: qData.q, 
                                theory_context: `ã€è€é«˜è¯­å½•/åŸæ„ã€‘ï¼š${qData.intent}\nã€å¼•å¯¼å®æ“ã€‘ï¼š${qData.guide}\n\nè¯·åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œç”¨è€é«˜çš„å£å»ï¼ˆé¼“åŠ±ã€ç›´æ¥ã€æ‰“ç ´å¸¸è§„ï¼‰ç®€çŸ­åœ°å¼•å¯¼ç”¨æˆ·å›ç­”è¿™é“é¢˜ã€‚ä¸è¦æåŠå…¶ä»–é—®é¢˜ã€‚\n\nã€é‡è¦æ ¼å¼è¦æ±‚ã€‘ï¼šè¯·åªè¿”å›çº¯æ–‡æœ¬ï¼Œä¸è¦ä½¿ç”¨HTMLæ ‡ç­¾ã€‚` 
                            } 
                        })
                    });
                    const json = await res.json();
                    openHint('ğŸ’¡ æ€è·¯é”¦å›Š', { intent: qData.intent, guide: qData.guide, aiContent: json.data });
                } catch (e) { 
                    console.error(e);
                    openHint('ğŸ’¡ æ€è·¯é”¦å›Š', { intent: qData.intent, guide: qData.guide }); 
                }
                btn.innerHTML = originalHtml;
            }

            async function handleRefine(idx) {
                const inputEl = document.getElementById(`input-${idx}`);
                const val = inputEl.value.trim();
                if (!val) return alert("å…ˆå†™ç‚¹ä¸œè¥¿ï¼Œæˆ‘æ‰èƒ½å¸®ä½ æ¶¦è‰²å“¦");
                const btn = event.currentTarget;
                const originalHtml = btn.innerHTML;
                btn.innerHTML = `<span class="animate-spin">âœ¨</span> ä¼˜åŒ–ä¸­...`;
                try {
                    const res = await fetch(API_URL, { 
                        method: "POST", 
                        headers: { "Content-Type": "application/json" }, 
                        body: JSON.stringify({ action: 'refine', data: { text: val } }) 
                    });
                    const json = await res.json();
                    if (json.data) { inputEl.value = json.data; saveSingleInput(idx); }
                } catch(e) { alert("è¿æ¥è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–APIåœ°å€é…ç½®"); }
                btn.innerHTML = originalHtml;
            }

            // è¡¥å…¨äº†ä½ ä»£ç é‡Œæ–­æ‰çš„éƒ¨åˆ†
            async function submitData() {
                document.getElementById('form-container').classList.add('hidden');
                document.getElementById('footer-nav').classList.add('hidden');
                document.getElementById('loading-screen').classList.remove('hidden');
                
                const analysisInstruction = `ä½ æ˜¯ä¸€ä½ç²¾é€šå…«æœ¨ä»å¹³â€œè‡ªæˆ‘è®¤çŸ¥æ¨¡å‹â€çš„èŒä¸šè§„åˆ’å¤§å¸ˆï¼ˆåŸºäºè€é«˜è§†é¢‘ç†è®ºï¼‰ã€‚è¯·é˜…è¯»ç”¨æˆ·çš„16ä¸ªé—®é¢˜çš„å›ç­”ï¼Œæ·±åº¦åˆ†æã€‚
                
                ä»»åŠ¡ï¼š
                1. ä»å›ç­”ä¸­æå–ã€Values ä»·å€¼è§‚ã€‘ã€ã€Talents æ‰èƒ½ã€‘ã€ã€Passion çƒ­æƒ…ã€‘çš„å…³é”®è¯ã€‚
                2. ç»„åˆæˆä¸€ä¸ªäººç”Ÿå…¬å¼å¥å­ã€‚
                3. ç»™å‡ºå…·ä½“çš„èŒä¸šæˆ–è¡ŒåŠ¨å»ºè®®ã€‚
                
                ã€é‡è¦ã€‘ï¼šè¯·ä¸¥æ ¼è¿”å› JSON æ ¼å¼ï¼Œä¸è¦åŒ…å« markdown æ ‡è®°ã€‚æ ¼å¼å¦‚ä¸‹ï¼š
                {
                    "values": "å…³é”®è¯1, å…³é”®è¯2",
                    "talents": "å…³é”®è¯1, å…³é”®è¯2",
                    "passion": "å…³é”®è¯1, å…³é”®è¯2",
                    "formula_sentence": {
                        "passion": "xxxé¢†åŸŸ",
                        "talent": "xxxæ‰‹æ®µ",
                        "value": "xxxç›®çš„"
                    },
                    "advice": "ä¸€æ®µè¯¦ç»†çš„èŒä¸šæˆ–è¡ŒåŠ¨å»ºè®®..."
                }`;

                try {
                    const res = await fetch(API_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            action: 'analyze',
                            user_name: userName,
                            answers: userAnswers,
                            system_prompt: analysisInstruction
                        })
                    });
                    const json = await res.json();
                    const result = json.data; // å‡è®¾ API è¿”å›ç»“æ„

                    // æ¸²æŸ“ç»“æœ
                    document.getElementById('loading-screen').classList.add('hidden');
                    document.getElementById('result-screen').classList.remove('hidden');
                    
                    document.getElementById('res-name').innerText = userName;
                    document.getElementById('kw-values').innerText = result.values || "æœªè¯†åˆ«";
                    document.getElementById('kw-talents').innerText = result.talents || "æœªè¯†åˆ«";
                    document.getElementById('kw-passion').innerText = result.passion || "æœªè¯†åˆ«";
                    
                    if(result.formula_sentence) {
                        document.getElementById('f-passion').innerText = result.formula_sentence.passion || "...";
                        document.getElementById('f-talent').innerText = result.formula_sentence.talent || "...";
                        document.getElementById('f-value').innerText = result.formula_sentence.value || "...";
                    }
                    
                    document.getElementById('res-advice').innerText = result.advice || "AI åˆ†ææš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥ API è¿”å›ã€‚";

                } catch (e) {
                    console.error(e);
                    alert("ç”ŸæˆæŠ¥å‘Šå¤±è´¥ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºï¼š\n1. API åœ°å€æ²¡æ”¹ï¼ˆè¿˜æ˜¯é»˜è®¤çš„ mylaogao.topï¼‰\n2. åç«¯ Workers æ²¡éƒ¨ç½²å¥½\n\nç°åœ¨å°†æ˜¾ç¤ºæ¨¡æ‹Ÿç»“æœç”¨äºæ¼”ç¤ºã€‚");
                    
                    // æ¼”ç¤ºç”¨å…œåº•æ•°æ®
                    document.getElementById('loading-screen').classList.add('hidden');
                    document.getElementById('result-screen').classList.remove('hidden');
                    document.getElementById('kw-values').innerText = "è‡ªç”±, åˆ›é€ ";
                    document.getElementById('kw-talents').innerText = "é€»è¾‘åˆ†æ, æ´å¯Ÿ";
                    document.getElementById('kw-passion').innerText = "äº’è”ç½‘, å¿ƒç†å­¦";
                    document.getElementById('f-passion').innerText = "å¿ƒç†å­¦ä¸ç§‘æŠ€ç»“åˆ";
                    document.getElementById('f-talent').innerText = "æ·±åº¦åˆ†æèƒ½åŠ›";
                    document.getElementById('f-value').innerText = "å¸®åŠ©ä»–äººè§‰é†’";
                    document.getElementById('res-advice').innerText = "æ¼”ç¤ºæ¨¡å¼ï¼šçœ‹èµ·æ¥ä½ éå¸¸é€‚åˆåšä¸€ä¸ªç‹¬ç«‹çš„å’¨è¯¢å¸ˆæˆ–å†…å®¹åˆ›ä½œè€…ã€‚";
                }
            }
        </script>
	</body>
</html>
