<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç”Ÿä½¿ç”¨è¯´æ˜ä¹¦ - æ·±åº¦è§£æç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; background-color: #fdfbf7; color: #333; }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        textarea { resize: vertical; }
        .circle-card { transition: all 0.3s; }
        .circle-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 3px; }
        
        /* å¼¹çª—åŠ¨ç”» */
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px); }
        .modal-content { animation: popIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        @keyframes popIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    </style>
</head>
<body class="min-h-screen py-6 px-4 flex justify-center items-start">

    <div class="max-w-3xl w-full bg-white shadow-2xl rounded-3xl overflow-hidden border border-stone-200 flex flex-col" style="min-height: 90vh;">
        
        <!-- é¡¶éƒ¨è¿›åº¦æ¡ -->
        <div class="w-full bg-stone-100 h-2">
            <div id="progress-bar" class="bg-stone-800 h-2 transition-all duration-500" style="width: 0%"></div>
        </div>

        <!-- å¤´éƒ¨ -->
        <div class="p-6 border-b border-stone-100 bg-white sticky top-0 z-30 shadow-sm flex justify-between items-center">
            <div>
                <!-- å¢åŠ äº†ä¸€ä¸ªå¾®å°çš„è¿”å›æŒ‰é’®ï¼Œæ–¹ä¾¿ç”¨æˆ·å›åˆ°åšå®¢ -->
                <a href="/" class="text-xs text-stone-400 hover:text-stone-800 no-underline mb-1 block">â† è¿”å›é¦–é¡µ</a>
                <h1 class="text-xl font-bold text-stone-800 tracking-tight">äººç”Ÿä½¿ç”¨è¯´æ˜ä¹¦</h1>
                <p class="text-xs text-stone-500 mt-1 font-mono">LOGIC KERNEL: LAO GAO & YAGI JIMPEI</p>
            </div>
            <div class="flex gap-1">
                <div class="w-3 h-3 rounded-full bg-red-400" title="Values"></div>
                <div class="w-3 h-3 rounded-full bg-blue-400" title="Talents"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-400" title="Passion"></div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div id="app" class="flex-1 p-6 overflow-y-auto pb-20 scroll-smooth">
            
            <!-- 0. å¯åŠ¨é¡µ -->
            <div id="step-0" class="fade-in h-full flex flex-col justify-center items-center text-center space-y-8 py-12">
                <div class="relative">
                    <div class="text-7xl">ğŸ§¬</div>
                    <div class="absolute -bottom-2 -right-2 text-2xl">ğŸ—ï¸</div>
                </div>
                <div>
                    <h2 class="text-3xl font-bold text-stone-800 mb-3">å¯»æ‰¾å‡ºå‚è®¾ç½®</h2>
                    <p class="text-stone-500 text-sm leading-relaxed max-w-md mx-auto">
                        æˆ‘ä»¬å°†é€šè¿‡ 16 ä¸ªæ½œæ„è¯†æ¢é’ˆï¼Œ<br>
                        æå–ä½ çš„<span class="text-red-500 font-bold">ä»·å€¼è§‚</span>ã€<span class="text-blue-500 font-bold">æ‰èƒ½</span>ä¸<span class="text-yellow-500 font-bold">çƒ­æƒ…</span>ã€‚<br>
                        æœ€åç”Ÿæˆç‹¬å±äºä½ çš„â€œäººç”Ÿå…¬å¼â€ã€‚
                    </p>
                </div>
                <div class="w-full max-w-xs space-y-4">
                    <input type="text" id="user-name" placeholder="è¯·è¾“å…¥ä½ çš„åå­—" class="w-full p-4 bg-stone-50 border border-stone-200 rounded-xl text-center focus:border-stone-800 outline-none transition font-bold text-lg">
                    <button onclick="start()" class="w-full bg-stone-800 text-white py-4 rounded-xl hover:bg-stone-900 transition font-bold shadow-lg text-lg tracking-wide">å¼€å§‹è§£æ</button>
                </div>
            </div>

            <!-- é—®å·è¡¨å•åŒº -->
            <div id="form-container" class="hidden fade-in">
                <div class="flex items-center gap-3 mb-8">
                    <span id="chapter-badge" class="bg-stone-800 text-white px-3 py-1 rounded text-xs font-bold tracking-wider">PART 1</span>
                    <div>
                        <h2 id="chapter-title" class="text-2xl font-bold text-stone-800"></h2>
                        <p id="section-desc" class="text-sm text-stone-500 mt-1"></p>
                    </div>
                </div>

                <!-- é—®é¢˜åˆ—è¡¨å®¹å™¨ -->
                <div id="questions-list" class="space-y-12">
                    <!-- åŠ¨æ€ç”Ÿæˆé—®é¢˜ -->
                </div>
            </div>

            <!-- åŠ è½½ä¸­ -->
            <div id="loading-screen" class="hidden h-full flex flex-col justify-center items-center text-center fade-in py-20">
                <div class="animate-spin text-5xl mb-6">â³</div>
                <h3 class="text-2xl font-bold text-stone-800">æ­£åœ¨è¿æ¥æ½œæ„è¯†...</h3>
                <div class="text-stone-500 text-sm mt-4 space-y-2 font-mono text-left inline-block">
                    <p>Step 1: æå–å…³é”®è¯ï¼ˆå¯»æ‰¾é‡å¤é¡¹ï¼‰...</p>
                    <p>Step 2: å¡«å…¥ä¸‰åœ†åœˆï¼ˆä»·å€¼è§‚/æ‰èƒ½/çƒ­æƒ…ï¼‰...</p>
                    <p>Step 3: ç»„åˆäººç”Ÿå…¬å¼ï¼ˆé€ å¥ï¼‰...</p>
                    <p>Step 4: åŒ¹é…ç°å®è½½ä½“ï¼ˆèŒä¸šï¼‰...</p>
                </div>
            </div>

            <!-- ç»“æœé¡µ -->
            <div id="result-screen" class="hidden fade-in space-y-10 pb-10">
                <div class="text-center border-b border-stone-100 pb-6">
                    <h2 class="text-3xl font-bold text-stone-800">åˆ†ææŠ¥å‘Š</h2>
                    <p class="text-stone-500 text-sm mt-2">å—æµ‹è€…: <span id="res-name" class="font-bold text-black text-lg"></span></p>
                </div>

                <!-- 1. ä¸‰åœ†åœˆå…³é”®è¯ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="circle-card bg-red-50 p-5 rounded-2xl border border-red-100 text-center flex flex-col justify-between">
                        <div class="text-xs font-black text-red-400 mb-2 tracking-widest uppercase">VALUES (æŒ‡å—é’ˆ)</div>
                        <div id="kw-values" class="text-lg font-bold text-red-900 leading-snug"></div>
                        <div class="text-[10px] text-red-300 mt-2">ä½ çš„ç†æƒ³çŠ¶æ€</div>
                    </div>
                    <div class="circle-card bg-blue-50 p-5 rounded-2xl border border-blue-100 text-center flex flex-col justify-between">
                        <div class="text-xs font-black text-blue-400 mb-2 tracking-widest uppercase">TALENTS (æ‰‹æ®µ)</div>
                        <div id="kw-talents" class="text-lg font-bold text-blue-900 leading-snug"></div>
                        <div class="text-[10px] text-blue-300 mt-2">ä½ çš„æ— æ„è¯†ä¹ æƒ¯</div>
                    </div>
                    <div class="circle-card bg-yellow-50 p-5 rounded-2xl border border-yellow-100 text-center flex flex-col justify-between">
                        <div class="text-xs font-black text-yellow-600 mb-2 tracking-widest uppercase">PASSION (é¢†åŸŸ)</div>
                        <div id="kw-passion" class="text-lg font-bold text-yellow-900 leading-snug"></div>
                        <div class="text-[10px] text-yellow-500 mt-2">ä½ æ„¿æ„æŠ•å…¥çš„åœ°æ–¹</div>
                    </div>
                </div>

                <!-- 2. äººç”Ÿå…¬å¼ -->
                <div class="bg-stone-900 text-white p-8 rounded-3xl shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 text-8xl opacity-10 select-none">âš¡</div>
                    <h3 class="text-center text-stone-400 text-xs font-bold tracking-widest uppercase mb-6">YOUR LIFE FORMULA</h3>
                    
                    <div class="text-center space-y-6">
                        <p class="text-lg md:text-xl leading-relaxed font-light text-stone-300">
                            æˆ‘æƒ³åœ¨ 
<span id="f-passion" class="text-yellow-400 font-bold border-b border-yellow-400/30 pb-1"></span>
 çš„é¢†åŸŸ
                        </p>
                        <p class="text-lg md:text-xl leading-relaxed font-light text-stone-300">
                            åˆ©ç”¨æˆ‘çš„ 
<span id="f-talent" class="text-blue-400 font-bold border-b border-blue-400/30 pb-1"></span>
                        </p>
                        <p class="text-2xl md:text-3xl leading-relaxed font-bold text-white mt-4">
                            å»å®ç° 
<span id="f-value" class="text-red-500 bg-white/10 px-3 py-1 rounded-lg"></span>
                        </p>
                    </div>
                </div>

                <!-- 3. èŒä¸šè½½ä½“å»ºè®® -->
                <div class="bg-white border border-stone-200 p-6 rounded-2xl">
                    <h3 class="font-bold text-stone-800 mb-4 flex items-center gap-2">
                        <span class="text-xl">ğŸ’¼</span>
 ç°å®èŒä¸šè½½ä½“ (åŒ¹é…ç»“æœ)
                    </h3>
                    <p id="res-advice" class="text-sm text-stone-600 leading-loose whitespace-pre-line"></p>
                </div>
                
                <button onclick="location.reload()" class="w-full py-4 bg-stone-50 border border-stone-200 rounded-xl text-stone-500 text-sm hover:bg-stone-100 hover:text-stone-800 transition font-bold">é‡æ–°æµ‹è¯•</button>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <div id="footer-nav" class="hidden p-4 border-t border-stone-100 bg-white sticky bottom-0 z-20 flex gap-3">
            <button onclick="prevSection()" id="prev-btn" class="flex-1 bg-white border border-stone-200 text-stone-600 py-3 rounded-xl hover:bg-stone-50 transition font-bold disabled:opacity-50">
                â† ä¸Šä¸€æ­¥
            </button>
            <button onclick="nextSection()" id="next-btn" class="flex-[2] bg-stone-800 text-white py-3 rounded-xl hover:bg-stone-700 transition font-bold shadow-lg">
                ä¸‹ä¸€æ­¥ â†’
            </button>
        </div>
        
        <!-- å¸®åŠ©å¼¹çª— (V12 ä¿®å¤ç‰ˆ: åŒ…å«è€é«˜è¯­å½•+å®æ“+AIå»ºè®®) -->
        <div id="hint-modal" class="fixed inset-0 z-50 hidden modal-backdrop flex items-center justify-center px-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col modal-content max-h-[80vh]">
                <div class="p-6 border-b border-stone-100 flex justify-between items-center sticky top-0 bg-stone-50">
                    <h3 class="text-lg font-bold text-stone-800 flex items-center gap-2">
                        <span>ğŸ’¡</span>
 æ€è·¯é”¦å›Š
                    </h3>
                    <button onclick="closeHint()" class="text-stone-400 hover:text-stone-800 text-2xl leading-none">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto space-y-6 text-sm text-stone-600 leading-relaxed">
                    <!-- 1. è€é«˜è¯­å½• (ç†è®º) -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h4 class="font-bold text-yellow-700 mb-2 text-xs uppercase tracking-wider">è€é«˜æ ¸å¿ƒè¯­å½•</h4>
                        <p id="modal-intent" class="text-yellow-900"></p>
                    </div>
                    
                    <!-- 2. å¼•å¯¼å®æ“ (Action) -->
                    <div>
                        <h4 class="font-bold text-stone-800 mb-2 text-xs uppercase tracking-wider">ğŸ¯ å¼•å¯¼å®æ“</h4>
                        <p id="modal-guide" class="whitespace-pre-line"></p>
                    </div>

                    <!-- 3. AI å»ºè®® (Dynamic) -->
                    <div id="modal-ai-section" class="hidden border-t border-stone-100 pt-4">
                        <h4 class="font-bold text-blue-600 mb-2 text-xs uppercase tracking-wider flex items-center gap-1">
                            <span>ğŸ¤–</span>
 AI è¡¥å……å»ºè®®
                        </h4>
                        <p id="modal-ai-content" class="text-stone-700 whitespace-pre-line"></p>
                    </div>
                </div>
                <div class="p-4 border-t border-stone-100 bg-stone-50 text-center">
                    <button onclick="closeHint()" class="bg-stone-800 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-stone-700 transition w-full">æˆ‘æ˜ç™½äº†</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const API_URL = "https://life-path-api.leguanchen579.workers.dev"; 

        // å·¥å…·ï¼šæ¸…æ´—æ–‡æœ¬ï¼ˆå»æ‰ Markdown åˆ—è¡¨ç¬¦å’Œå¤šä½™ç©ºè¡Œï¼Œä¿è¯å¼¹çª—æ•´æ´ï¼‰
        function cleanText(text) {
            if (!text) return "";
            return text
                .replace(/<br\s*\/?>/gi, '\n')  
                .replace(/<\/li>/gi, '\n')      
                .replace(/<li>/gi, 'â€¢ ')        
                .replace(/<[^>]+>/g, '')        
                .replace(/^\s*[\-\*]\s+/gm, 'â€¢ ') // å°† markdown çš„ - æ›¿æ¢ä¸º â€¢
                .trim();
        }

        function openHint(title, contentData) {
            document.getElementById('hint-modal').classList.remove('hidden');
            
            // å¡«å……é™æ€æ•°æ®
            document.getElementById('modal-intent').innerText = cleanText(contentData.intent);
            document.getElementById('modal-guide').innerText = cleanText(contentData.guide);
            
            // å¡«å…… AI åŠ¨æ€æ•°æ®
            const aiSection = document.getElementById('modal-ai-section');
            if (contentData.aiContent) {
                aiSection.classList.remove('hidden');
                document.getElementById('modal-ai-content').innerText = cleanText(contentData.aiContent);
            } else {
                aiSection.classList.add('hidden');
            }
        }

        function closeHint() {
            document.getElementById('hint-modal').classList.add('hidden');
        }

        // ============================================================
        // å®Œæ•´æ•°æ®æº (åŒ…å« intent å’Œ guide)
        // ============================================================
        const chapters = [
            {
                id: "values",
                name: "ä»·å€¼è§‚ (Values)",
                desc: "æ ¸å¿ƒï¼šä½ æœ€çœ‹é‡ä»€ä¹ˆï¼Ÿ(ç”¨ç›´è§‰ï¼Œä¸è¦æ€è€ƒ)",
                questions: [
                    {
                        q: "1. ä½ å°Šæ•¬çš„äººæ˜¯è°ï¼Ÿ(â˜… èµ·ç‚¹é—®é¢˜)",
                        intent: "ä¸è¦æƒ³å¤ªä¹…ï¼Œç›´è§‰æ˜¯è°å°±æ˜¯è°ã€‚èŒƒå›´æ— é™å®½ï¼šå¯ä»¥æ˜¯èº«è¾¹çš„çˆ¶æ¯ï¼Œå¯ä»¥æ˜¯åäººï¼Œç”šè‡³å¯ä»¥æ˜¯æ¼«ç”»äººç‰©ã€‚æ˜¯ä¸æ˜¯çœŸäººéƒ½æ— æ‰€è°“ï¼Œå…³é”®æ˜¯ç¬¬ä¸€æ—¶é—´å‡ºç°åœ¨ä½ è„‘å­é‡Œçš„é‚£ä¸ªåå­—ã€‚",
                        guide: "åˆ«ç­›é€‰ï¼Œåˆ«ç®¡é‚£ä¸ªäººå¤Ÿä¸å¤Ÿä¼Ÿå¤§ã€‚æ­¤æ—¶æ­¤åˆ»ä½ è„‘å­é‡Œè¹¦å‡ºæ¥çš„ç¬¬ä¸€ä¸ªåå­—æ˜¯è°ï¼Ÿå“ªæ€•æ˜¯åŠ¨ç”»ç‰‡é‡Œçš„è§’è‰²ä¹Ÿå†™ä¸‹æ¥ã€‚"
                    },
                    {
                        q: "2. ä¸ºä»€ä¹ˆå°Šæ•¬ä»–ï¼Ÿ/ å–œæ¬¢ä»–ä»€ä¹ˆåœ°æ–¹ï¼Ÿ",
                        intent: "åå­—ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯â€˜ä¸ºä»€ä¹ˆâ€™ã€‚ä½ è¦æŠŠå–œæ¬¢ä»–çš„å…·ä½“ç†ç”±å†™ä¸‹æ¥ã€‚æ¯”å¦‚â€˜å› ä¸ºä»–è‡ªç”±â€™ã€â€˜å› ä¸ºä»–ä»æœªæ”¾å¼ƒâ€™ã€‚è¿™äº›å½¢å®¹è¯ï¼ˆå…³é”®è¯ï¼‰ï¼Œæ‰æ˜¯ä½ çœŸæ­£çš„ä»·å€¼è§‚ã€‚",
                        guide: "åˆ«å…‰è¯´â€˜ä»–å¾ˆé…·â€™ã€‚å…·ä½“ç‚¹ï¼Œä»–å“ªä¸€ç‚¹æ‰“åŠ¨äº†ä½ ï¼Ÿæ˜¯ä»–æ‰“ç ´äº†è§„åˆ™ï¼Ÿè¿˜æ˜¯ä»–ç‰¹åˆ«æ¸©æŸ”ï¼ŸæŠŠé‚£ä¸ªå½¢å®¹è¯åœˆå‡ºæ¥ã€‚"
                    },
                    {
                        q: "3. é’æ˜¥æœŸå¯¹ä½ å½±å“å¾ˆå¤§çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ",
                        intent: "å›æƒ³åˆä¸­ã€é«˜ä¸­æ—¶æœŸï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆäº‹å¯¹ä½ çš„ä¸–ç•Œè§‚äº§ç”Ÿäº†å·¨å¤§å†²å‡»ï¼Ÿä¸€å®šæœ‰ï¼Œä¸å¯èƒ½æ²¡æœ‰ï¼Œä»”ç»†æƒ³ã€‚é‚£æ—¶å€™ä½ æ„Ÿæ€§æœ€ä¸°å¯Œï¼Œç•™ä¸‹çš„ä¸œè¥¿å°±æ˜¯ä½ ç°åœ¨çš„æ ¸å¿ƒä»·å€¼è§‚ã€‚",
                        guide: "é‚£æ—¶å€™æœ‰æ²¡æœ‰è®©ä½ è§‰å¾—ç‰¹åˆ«ä¸å…¬å¹³çš„äº‹ï¼Ÿæˆ–è€…è®©ä½ ç¬é—´è§‰å¾—â€˜æˆ‘å°±è¦è¿™æ ·æ´»â€™çš„æ—¶åˆ»ï¼Ÿå“ªæ€•æ˜¯ä¸€æ¬¡è¢«å†¤æ‰çš„ç»å†ï¼Œæˆ–è€…è¯»åˆ°çš„ä¸€å¥è¯ã€‚"
                    },
                    {
                        q: "4. ä½ è§‰å¾—ç°åœ¨ç¤¾ä¼šæœ‰ä»€ä¹ˆä¸è¶³çš„åœ°æ–¹ï¼Ÿ",
                        intent: "ä½ è§‰å¾—ç°åœ¨çš„ç¤¾ä¼šç¼ºä»€ä¹ˆï¼Ÿæˆ–è€…è¯´ï¼Œä½ çœ‹ä¸æƒ¯è¿™ä¸ªç¤¾ä¼šçš„å“ªé‡Œï¼Ÿä½ è§‰å¾—å®ƒå“ªé‡Œä¸å¯¹ï¼Ÿ",
                        guide: "å¦‚æœä½ æœ‰é­”æ³•èƒ½æ”¹å˜ç¤¾ä¼šçš„ä¸€ä¸ªç°çŠ¶ï¼Œä½ ä¼šæ”¹ä»€ä¹ˆï¼Ÿï¼ˆä½ æƒ³è¡¥å…¨çš„é‚£ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯ä½ æœ€çœ‹é‡çš„ä»·å€¼ï¼‰ã€‚"
                    },
                    {
                        q: "5. åœ¨æœ‹å‹çœ¼é‡Œä½ æ˜¯ä¸€ä¸ªçœ‹ä¸­ä»€ä¹ˆä¸œè¥¿çš„äººï¼Ÿ",
                        intent: "è¿™ä¸€é¢˜ï¼Œå¿…é¡»å»é—®åˆ«äººã€‚ä½ è‡ªå·±æƒ³çš„ä¸ç®—ã€‚å‘å¾®ä¿¡é—®æœ‹å‹ã€å®¶äººï¼šâ€˜ä½ è§‰å¾—æˆ‘æœ€çœ‹é‡ä»€ä¹ˆï¼Ÿâ€™ ä»–ä»¬çš„å›ç­”å¾€å¾€æ‰æ˜¯çœŸç›¸ã€‚",
                        guide: "ã€å¼ºåˆ¶æ‰§è¡Œã€‘æ‹¿å‡ºæ‰‹æœºï¼Œç°åœ¨å‘ç»™ä¸‰ä¸ªæ­»å…šã€‚ä¸è¦è‡ªå·±ççŒœï¼ŒæŠŠä»–ä»¬å›è¿‡æ¥çš„é‚£ä¸ªè¯åŸå°ä¸åŠ¨è®°ä¸‹æ¥ã€‚"
                    },
                    {
                        q: "6. ç»™èº«è¾¹äººçš„å»ºè®®ï¼Ÿ/ ä¸å¸Œæœ›æœ‹å‹ç»™ä½ ä»€ä¹ˆæ ·çš„å»ºè®®ï¼Ÿ",
                        intent: "ä½ ç»å¸¸æŒ‚åœ¨å˜´è¾¹åŠåˆ«äººçš„è¯æ˜¯ä»€ä¹ˆï¼Ÿè¿˜æœ‰ï¼Œåˆ«äººåŠä½ ä»€ä¹ˆæ—¶ï¼Œä½ å¿ƒé‡Œä¼šæƒ³â€˜çƒ¦æ­»äº†ã€ä½ åˆ«ç®¡æˆ‘â€™ï¼Ÿ",
                        guide: "ä½ æ˜¯ä¸æ˜¯æ€»å¿ä¸ä½æƒ³çº æ­£åˆ«äººæŸç§æ¯›ç—…ï¼Ÿé‚£ä¸ªæ¯›ç—…æ˜¯ä»€ä¹ˆï¼Ÿåè¿‡æ¥ï¼Œåˆ«äººåŠä½ â€˜ä½ è¦åˆç¾¤ç‚¹â€™è¿˜æ˜¯â€˜ä½ è¦ä¸Šè¿›ç‚¹â€™çš„æ—¶å€™ä½ ä¼šæœ€åæ„Ÿï¼Ÿ"
                    }
                ]
            },
            {
                id: "talents",
                name: "æ‰èƒ½ (Talents)",
                desc: "æ ¸å¿ƒï¼šä½ è§‰å¾—ç®€å•è€Œåˆ«äººè§‰å¾—éš¾çš„äº‹ (æ— æ„è¯†çš„ä¹ æƒ¯)",
                questions: [
                    {
                        q: "7. ç›®å‰äººç”Ÿæœ€å……å®çš„ç»å†æ˜¯ä»€ä¹ˆï¼Ÿ",
                        intent: "å“ªä¸€æ®µæ—¶é—´ä½ è§‰å¾—è¿‡å¾—ç‰¹åˆ«å¿«ï¼Ÿæˆ–è€…åšå®Œä¹‹åè§‰å¾—å¿ƒé‡Œæ»¡æ»¡çš„ï¼Œä¸€ç‚¹éƒ½ä¸è§‰å¾—ç´¯ï¼Ÿ",
                        guide: "ä»€ä¹ˆæ—¶å€™ä½ åšäº‹æƒ…ä¼šå¿˜è®°çœ‹æ‰‹æœºï¼Œå¿˜è®°åƒé¥­ï¼Ÿé‚£ç§â€˜é¡ºæ‰‹â€™çš„æ„Ÿè§‰æ˜¯åœ¨åšä»€ä¹ˆäº‹ï¼Ÿ"
                    },
                    {
                        q: "8. æœ€è¿‘ä¸€æ¬¡æ„Ÿåˆ°â€œä¸è€çƒ¦â€çš„äº‹æƒ…ï¼Ÿ(â˜…æŒ–æ˜å¤©èµ‹å…³é”®é¢˜)",
                        intent: "æ³¨æ„ï¼ä½ çœ‹è§è°åšäº‹ç¬¨æ‰‹ç¬¨è„šçš„ï¼Œè®©ä½ å¾ˆç«å¤§ï¼Ÿä½ å¿ƒé‡Œæƒ³â€˜è¿™ç©æ„å„¿è¿™ä¹ˆç®€å•ï¼Œä½ æ€ä¹ˆå°±åšä¸å¥½å‘¢ï¼Ÿâ€™ â€”â€”ä½ è§‰å¾—ç®€å•ä½†ä»–åšä¸å¥½çš„é‚£ä¸ªäº‹ï¼Œå°±æ˜¯ä½ çš„æ‰èƒ½ã€‚",
                        guide: "æœ€è¿‘æœ‰æ²¡æœ‰å“ªä¸ªç¬é—´è®©ä½ æƒ³æŠ¢è¿‡åˆ«äººçš„æ´»å„¿è‡ªå·±å¹²ï¼Ÿå› ä¸ºä½ å«Œä»–å¤ªæ…¢ã€å¤ªç¬¨äº†ï¼Ÿå…·ä½“æ˜¯å“ªä¸ªç¯èŠ‚è®©ä½ çœ‹ä¸ä¸‹å»ï¼Ÿ"
                    },
                    {
                        q: "9. é—®é—®èº«è¾¹çš„äººï¼Œä»–ä»¬è§‰å¾—ä½ æ“…é•¿ä»€ä¹ˆï¼Ÿ",
                        intent: "æ‰èƒ½æ˜¯æ— æ„è¯†çš„ï¼Œåƒå‘¼å¸ä¸€æ ·ï¼Œä½ è‡ªå·±å‘ç°ä¸äº†ã€‚æ‰€ä»¥è¿™é¢˜ä¹Ÿå¾—é—®åˆ«äººï¼šâ€˜ä½ è§‰å¾—æˆ‘å¹²ä»€ä¹ˆæœ€å‰å®³ï¼Ÿâ€™",
                        guide: "è¿™ä¸€é¢˜ä½ è‡ªå·±ç»å¯¹ç­”ä¸å‡†ã€‚å»é—®åˆ«äººï¼Œæˆ–è€…å›æƒ³ä¸€ä¸‹ï¼Œåˆ«äººæœ€å¸¸å¤¸ä½ çš„ä¸€å¥è¯æ˜¯ä»€ä¹ˆï¼Ÿ æ˜¯â€˜ä½ çœŸç»†å¿ƒâ€™è¿˜æ˜¯â€˜ä½ ç‚¹å­çœŸå¤šâ€™ï¼Ÿ"
                    },
                    {
                        q: "10. å¦‚æœæ”¾å¼ƒç°åœ¨çš„å·¥ä½œï¼Œä½ ç‰¹åˆ«æƒ³åšçš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ",
                        intent: "å¦‚æœæ²¡æœ‰é’±çš„é—®é¢˜ï¼Œæˆ–è€…ä½ è¢«ç‚’é±¿é±¼äº†ï¼Œä½ æœ¬èƒ½åœ°æƒ³å»å¹²ä»€ä¹ˆï¼Ÿä¸æ˜¯ä¸ºäº†ç”Ÿå­˜ï¼Œè€Œæ˜¯ä¸ºäº†æƒ³å¹²ã€‚",
                        guide: "å‡è®¾ä½ ä¸­äº†å½©ç¥¨ï¼Œé’±å‡ è¾ˆå­èŠ±ä¸å®Œã€‚ç©è…»äº†ä¹‹åï¼Œä½ æ¯å¤©æ—©ä¸Šèµ·æ¥æƒ³å»ç¢ç£¨ç‚¹ä»€ä¹ˆäº‹æ¥æ‰“å‘æ—¶é—´ï¼Ÿ"
                    },
                    {
                        q: "11. ç›®å‰ä¸ºæ­¢ä½ åšè¿‡æœ€æˆåŠŸçš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ",
                        intent: "ä¸éœ€è¦æ˜¯å¤§æˆåŠŸï¼Œå°äº‹ä¹Ÿè¡Œã€‚åªè¦æ˜¯æœ‰äº†ç»“æœçš„äº‹æƒ…ã€‚å“ªæ€•æ˜¯ç»„ç»‡äº†ä¸€æ¬¡èšé¤å¤§å®¶éƒ½æŒºå¼€å¿ƒï¼Œè¿™ä¹Ÿç®—ã€‚",
                        guide: "ä»å°åˆ°å¤§ï¼Œå“ªæ€•æ˜¯å°å­¦å¾—çš„å°çº¢èŠ±ï¼Œæˆ–è€…å¸®æœ‹å‹è§£å†³äº†ä¸€ä¸ªéº»çƒ¦ï¼Œå“ªä»¶äº‹åšå®Œè®©ä½ è§‰å¾—è‡ªå·±â€˜æŒºè¡Œâ€™çš„ï¼Ÿ"
                    }
                ]
            },
            {
                id: "passion",
                name: "æ„¿æœ›å’Œæ¢¦æƒ³ (Passion)",
                desc: "æ ¸å¿ƒï¼šçœŸçˆ±æ˜¯æ„¿æ„ä»˜å‡ºä»£ä»·çš„ (ç”¨é’±å’Œè¡ŒåŠ¨æŠ•ç¥¨)",
                questions: [
                    {
                        q: "12. ä»€ä¹ˆäº‹æƒ…å°±ç®—èŠ±é’±ä½ ä¹Ÿæ„¿æ„å»å­¦ï¼Ÿ",
                        intent: "çœŸçš„çƒ­æƒ…æ˜¯éœ€è¦èŠ±ä»£ä»·çš„ã€‚å¾ˆå¤šäººè¯´å–œæ¬¢ï¼Œä¸€å¬è¯´è¦äº¤å­¦è´¹å°±ä¸å»äº†ï¼Œé‚£ä¸æ˜¯æ¢¦æƒ³ã€‚ä½ æ„¿æ„æè…°åŒ…å»å­¦ä»€ä¹ˆï¼Ÿ",
                        guide: "ç°åœ¨ç»™ä½ ä¸€ç¬”é’±ï¼Œè§„å®šåªèƒ½ç”¨æ¥æŠ¥ç­å­¦ä¹ ï¼Œä¸èƒ½ä¹°ä¸œè¥¿ã€‚ä½ ç¬¬ä¸€ååº”æ˜¯å»æŠ¥ä¸ªä»€ä¹ˆç­ï¼Ÿ"
                    },
                    {
                        q: "13. ä½ çš„ä¹¦æ¶ä¸Š(æˆ–æµè§ˆè®°å½•)æœ‰ä»€ä¹ˆå†…å®¹çš„ä¹¦ï¼Ÿ",
                        intent: "å»ç¿»ç¿»ä½ çš„ä¹¦æ¶ï¼Œæˆ–è€…æµè§ˆè®°å½•ã€‚ä½ å¹³æ—¶éƒ½åœ¨çœ‹ä»€ä¹ˆï¼Ÿé‚£äº›ä½ â€˜ä¹°å›æ¥â€™çš„ä¿¡æ¯ï¼Œæš´éœ²äº†ä½ çœŸæ­£çš„å¥½å¥‡å¿ƒã€‚",
                        guide: "æ‰“å¼€ä½ çš„è´­ç‰©è½¯ä»¶æˆ–è§†é¢‘APPï¼Œä½ å…³æ³¨æœ€å¤šçš„é‚£ä¸ªåˆ†ç±»æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å†å²ï¼Ÿæ˜¯æœºæ¢°ï¼Ÿè¿˜æ˜¯å¿ƒç†å­¦ï¼Ÿåˆ«çœ‹ä½ å¿…é¡»å­¦çš„ï¼Œçœ‹ä½ é—²ç€æ²¡äº‹å°±æƒ³ç‚¹çš„ã€‚"
                    },
                    {
                        q: "14. ä»€ä¹ˆå†…å®¹/çŸ¥è¯†æ›¾ç»ç»™ä½ å¾ˆå¤§çš„å¸®åŠ©ï¼Ÿ",
                        intent: "æœ‰æ²¡æœ‰ä¸€æœ¬ä¹¦ã€ä¸€éƒ¨ç”µå½±ï¼Œåœ¨ä½ äººç”Ÿä½è°·çš„æ—¶å€™æ•‘è¿‡ä½ ï¼Ÿæˆ–è€…è®©ä½ è±ç„¶å¼€æœ—ï¼Ÿ",
                        guide: "å¦‚æœä½ çš„æˆ¿å­ç€ç«äº†ï¼Œè®°å¿†é‡Œåªèƒ½ä¿ç•™ä¸€æœ¬ä¹¦æˆ–ä¸€éƒ¨ç”µå½±çš„å†…å®¹ï¼Œä½ ä¼šé€‰å“ªä¸ªï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹ä½ è¿™ä¹ˆé‡è¦ï¼Ÿ"
                    },
                    {
                        q: "15. ä½ æœ‰æƒ³è¦æ„Ÿè°¢çš„äººå’Œäº‹ä¹ˆï¼Ÿ",
                        intent: "ä½ æƒ³å¯¹è°è¯´è°¢è°¢ï¼Ÿé‚£ä¸ªè®©ä½ äº§ç”Ÿæ„Ÿæ¿€ä¹‹æƒ…çš„æºå¤´ï¼Œé€šå¸¸è¿ç€ä½ çš„çƒ­æƒ…ã€‚",
                        guide: "é—­ä¸Šçœ¼ç›ï¼Œè°çš„å¸®åŠ©è®©ä½ ç°åœ¨æƒ³èµ·æ¥è¿˜å¿ƒé‡Œæš–æš–çš„ï¼Ÿä»–å½“æ—¶å¸®äº†ä½ ä»€ä¹ˆï¼Ÿï¼ˆä½ æ„Ÿæ¿€çš„é‚£ä¸ªç‚¹ï¼Œå¾€å¾€æ˜¯ä½ ä¹Ÿæƒ³å¸¦ç»™åˆ«äººçš„ï¼‰ã€‚"
                    },
                    {
                        q: "16. ä½ å¯¹è¿™ä¸ªä¸–ç•Œæœ‰ä»€ä¹ˆä¸æ»¡ä¹ˆï¼Ÿ",
                        intent: "è¿™ä¸ªæ¯”â€˜ç¤¾ä¼šä¸è¶³â€™æ›´å¤§ã€‚ä½ å¯¹è¿™ä¸ªä¸–ç•Œæœ‰ä»€ä¹ˆæ„¤æ€’ï¼Ÿä½ å¸Œæœ›è¿™ä¸ªä¸–ç•Œå“ªé‡Œå˜å¾—æ›´å¥½ï¼Ÿä½ çš„ä½¿å‘½å¾€å¾€å°±è—åœ¨ä½ æƒ³è§£å†³çš„é—®é¢˜é‡Œã€‚",
                        guide: "çœ‹æ–°é—»çš„æ—¶å€™ï¼Œå“ªç±»äº‹ä¼šè®©ä½ ç‰¹åˆ«ç”Ÿæ°”ã€ç‰¹åˆ«éš¾å—ï¼Ÿå¦‚æœæ˜¯ç¥ï¼Œä½ æœ€æƒ³æ¶ˆç­ä¸–ç•Œä¸Šçš„ä»€ä¹ˆä¸œè¥¿ï¼ˆæ˜¯è´«ç©·ã€æˆ˜äº‰ã€è¿˜æ˜¯ä¸‘é™‹çš„è®¾è®¡ï¼‰ï¼Ÿ"
                    }
                ]
            }
        ];

        // ============================================================
        // æ ¸å¿ƒé€»è¾‘
        // ============================================================
        let currentSectionIdx = 0;
        let userName = "";
        let userAnswers = {};
        chapters.forEach(c => { userAnswers[c.id] = new Array(c.questions.length).fill(""); });

        function start() {
            const name = document.getElementById('user-name').value.trim();
            if (!name) return alert("è¯·å…ˆè¾“å…¥ä½ çš„åå­—");
            userName = name;
            document.getElementById('step-0').classList.add('hidden');
            document.getElementById('form-container').classList.remove('hidden');
            document.getElementById('footer-nav').classList.remove('hidden');
            document.getElementById('footer-nav').classList.add('flex');
            renderSection();
        }

        function renderSection() {
            const section = chapters[currentSectionIdx];
            const container = document.getElementById('questions-list');
            container.innerHTML = ""; 

            document.getElementById('chapter-badge').innerText = `PART ${currentSectionIdx + 1}`;
            document.getElementById('chapter-title').innerText = section.name;
            document.getElementById('section-desc').innerText = section.desc;
            document.getElementById('progress-bar').style.width = `${((currentSectionIdx) / 3) * 100}%`;

            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            prevBtn.style.display = (currentSectionIdx === 0) ? 'none' : 'block';
            nextBtn.innerText = (currentSectionIdx === chapters.length - 1) ? "âœ¨ ç”Ÿæˆåˆ†ææŠ¥å‘Š" : "ä¸‹ä¸€æ­¥ â†’";

            section.questions.forEach((item, idx) => {
                const wrapper = document.createElement('div');
                wrapper.className = "bg-stone-50 p-6 rounded-xl border border-stone-100 relative group hover:shadow-md transition duration-300";
                const savedValue = userAnswers[section.id][idx] || "";

                wrapper.innerHTML = `
                    <div class="mb-3">
                        <label class="block text-base font-bold text-stone-800">${item.q}</label>
                    </div>
                    <textarea id="input-${idx}" rows="3" class="w-full bg-white p-4 border border-stone-200 rounded-lg focus:ring-2 focus:ring-stone-800 focus:border-transparent outline-none transition text-sm text-stone-800 leading-relaxed" placeholder="è¯·å‡­ç›´è§‰å›ç­”..." onblur="saveSingleInput(${idx})">${savedValue}</textarea>
                    
                    <div class="flex flex-wrap justify-end gap-2 mt-3">
                        <button onclick="handleHint(${idx})" class="text-xs flex items-center gap-1 px-3 py-1.5 bg-white border border-stone-200 rounded-full text-stone-500 hover:text-stone-900 hover:border-stone-400 transition shadow-sm">
                            <span>ğŸ¤–</span> é—®é—®AIæ€ä¹ˆå†™
                        </button>
                        <button onclick="handleRefine(${idx})" class="text-xs flex items-center gap-1 px-3 py-1.5 bg-white border border-stone-200 rounded-full text-stone-500 hover:text-blue-600 hover:border-blue-200 transition shadow-sm">
                            <span>âœ¨</span> å¸®æˆ‘æ¶¦è‰²
                        </button>
                    </div>
                `;
                container.appendChild(wrapper);
            });
            document.getElementById('app').scrollTo(0,0);
        }

        function saveSingleInput(idx) {
            userAnswers[chapters[currentSectionIdx].id][idx] = document.getElementById(`input-${idx}`).value;
        }

        function saveCurrentInputs() {
            const sectionId = chapters[currentSectionIdx].id;
            const inputs = document.querySelectorAll('#questions-list textarea');
            inputs.forEach((input, idx) => { userAnswers[sectionId][idx] = input.value.trim(); });
            return Array.from(inputs).some(input => input.value.trim() !== "");
        }

        function prevSection() {
            saveCurrentInputs();
            if (currentSectionIdx > 0) { currentSectionIdx--; renderSection(); }
        }

        async function nextSection() {
            if (!saveCurrentInputs()) return alert("è¿™ä¸€é¡µå¥½åƒå…¨æ˜¯ç©ºçš„ï¼Ÿè¯·è‡³å°‘å›ç­”ä¸€ä¸ªé—®é¢˜å§ã€‚");
            if (currentSectionIdx < chapters.length - 1) { currentSectionIdx++; renderSection(); } 
            else { document.getElementById('progress-bar').style.width = "100%"; await submitData(); }
        }

        // ============================================================
        // AI äº¤äº’é€»è¾‘ (V12 æ ¸å¿ƒ)
        // ============================================================
        async function handleHint(idx) {
            const btn = event.currentTarget;
            const originalHtml = btn.innerHTML;
            btn.innerHTML = `<span class="animate-spin">â³</span> ç¿»é˜…è¯´æ˜ä¹¦...`;
            
            const section = chapters[currentSectionIdx];
            const qData = section.questions[idx];

            try {
                // è¯·æ±‚ AI è·å–å»ºè®®
                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        action: 'hint', 
                        context: section.name,
                        data: {
                            question: qData.q,
                            // V12 çš„å…³é”®ï¼šå°†è€é«˜ç†è®ºä¼ ç»™ AIï¼Œè®©å®ƒåŸºäºæ­¤ç»™å»ºè®®
                            theory_context: `ã€è€é«˜è¯­å½•/åŸæ„ã€‘ï¼š${qData.intent}\nã€å¼•å¯¼å®æ“ã€‘ï¼š${qData.guide}\n\nè¯·åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œç”¨è€é«˜çš„å£å»ï¼ˆé¼“åŠ±ã€ç›´æ¥ã€æ‰“ç ´å¸¸è§„ï¼‰ç®€çŸ­åœ°å¼•å¯¼ç”¨æˆ·å›ç­”è¿™é“é¢˜ã€‚ä¸è¦æåŠå…¶ä»–é—®é¢˜ã€‚\n\nã€é‡è¦æ ¼å¼è¦æ±‚ã€‘ï¼šè¯·åªè¿”å›çº¯æ–‡æœ¬ï¼Œä¸è¦ä½¿ç”¨HTMLæ ‡ç­¾ã€‚` 
                        }
                    })
                });
                const json = await res.json();
                
                // æ‰“å¼€å¼¹çª—ï¼Œå±•ç¤º 1.ç†è®º 2.å®æ“ 3.AIå»ºè®®
                openHint('ğŸ’¡ æ€è·¯é”¦å›Š', { 
                    intent: qData.intent, 
                    guide: qData.guide, 
                    aiContent: json.data 
                });

            } catch (e) {
                // é™çº§å¤„ç†ï¼šå¦‚æœ AI æŒ‚äº†ï¼Œè‡³å°‘æ˜¾ç¤ºæœ¬åœ°çš„ç†è®ºå’Œå®æ“
                openHint('ğŸ’¡ æ€è·¯é”¦å›Š', { 
                    intent: qData.intent, 
                    guide: qData.guide 
                });
            }
            btn.innerHTML = originalHtml;
        }

        async function handleRefine(idx) {
            const inputEl = document.getElementById(`input-${idx}`);
            const val = inputEl.value.trim();
            if (!val) return alert("å…ˆå†™ç‚¹ä¸œè¥¿ï¼Œæˆ‘æ‰èƒ½å¸®ä½ æ¶¦è‰²å“¦");
            
            const btn = event.currentTarget;
            const originalHtml = btn.innerHTML;
            btn.innerHTML = `<span class="animate-spin">âœ¨</span> ä¼˜åŒ–ä¸­...`;
            
            try {
                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ action: 'refine', data: { text: val } })
                });
                const json = await res.json();
                if (json.data) {
                    inputEl.value = json.data;
                    saveSingleInput(idx);
                }
            } catch(e) {
                console.error(e);
                alert("è¿æ¥è¶…æ—¶");
            }
            btn.innerHTML = originalHtml;
        }

        async function submitData() {
            document.getElementById('form-container').classList.add('hidden');
            document.getElementById('footer-nav').classList.add('hidden');
            document.getElementById('loading-screen').classList.remove('hidden');

            // å®šä¹‰åˆ†ææŒ‡ä»¤
            const analysisInstruction = `
ä½ æ˜¯ä¸€ä½ç²¾é€šå…«æœ¨ä»å¹³â€œè‡ªæˆ‘è®¤çŸ¥æ¨¡å‹â€çš„èŒä¸šè§„åˆ’å¤§å¸ˆï¼ˆåŸºäºè€é«˜è§†é¢‘ç†è®ºï¼‰ã€‚
è¯·é˜…è¯»ç”¨æˆ·çš„16ä¸ªå›ç­”ï¼Œä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ã€å››ä¸ªæ­¥éª¤ã€‘è¿›è¡Œåˆ†æï¼Œä¸è¦è·³æ­¥ï¼Œä¸è¦éšæ„å‘æŒ¥ã€‚

ã€Step 1ï¼šæå–å…³é”®è¯ï¼ˆæ‰¾é‡å¤é¡¹ï¼‰ã€‘
- é€šè¯»ç”¨æˆ·çš„æ‰€æœ‰ç­”æ¡ˆã€‚
- æ‰¾å‡ºé‡å¤å‡ºç°çš„è¯ï¼Œæˆ–è€…æ„æ€éå¸¸æ¥è¿‘çš„æ ¸å¿ƒè¯ã€‚
- å¿½ç•¥è¯­æ³•ï¼ŒåªæŠ“é‡ç‚¹ã€‚

ã€Step 2ï¼šå¡«å…¥â€œè‡ªæˆ‘è®¤çŸ¥â€ä¸‰åœ†åœˆï¼ˆåˆ†ç±»ï¼‰ã€‘
è¯·å°†Step 1æ‰¾åˆ°çš„å…³é”®è¯å¡«å…¥ä»¥ä¸‹ä¸‰ä¸ªåˆ†ç±»ï¼š
1. VALUES (ä»·å€¼è§‚/å¤§äº‹/çŠ¶æ€)ï¼š
   - æ¥æºï¼šQ1-Q6ã€‚
   - ç‰¹å¾ï¼šæŠ½è±¡çš„å½¢å®¹è¯æˆ–çŠ¶æ€ï¼ˆå¦‚ï¼šè‡ªç”±ã€å®‰å¿ƒã€åˆ›æ–°ã€è¢«éœ€è¦ã€è¯šå®ï¼‰ã€‚
   - æ„ä¹‰ï¼šè¿™æ˜¯äººç”Ÿçš„æŒ‡å—é’ˆï¼Œæ— è®ºåšä»€ä¹ˆéƒ½æƒ³ä¿æŒçš„çŠ¶æ€ã€‚
2. TALENTS (æ‰èƒ½/æ“…é•¿/æ‰‹æ®µ)ï¼š
   - æ¥æºï¼šQ7-Q11ã€‚
   - ç‰¹å¾ï¼šå…·ä½“çš„åŠ¨è¯æˆ–æ— æ„è¯†çš„ä¹ æƒ¯ï¼ˆå¦‚ï¼šè¯´è¯ã€æ•´ç†ã€å€¾å¬ã€åˆ†æã€ç¢ç£¨ï¼‰ã€‚
   - æ„ä¹‰ï¼šè¿™æ˜¯â€œä¸åŠªåŠ›ä¹Ÿèƒ½åšå¾—æ¯”åˆ«äººå¥½â€çš„åŠ¨ä½œã€‚
3. PASSION (çƒ­æƒ…/å–œæ¬¢/é¢†åŸŸ)ï¼š
   - æ¥æºï¼šQ12-Q16ã€‚
   - ç‰¹å¾ï¼šåè¯ã€è¡Œä¸šæˆ–å…·ä½“äº‹ç‰©ï¼ˆå¦‚ï¼šå¿ƒç†å­¦ã€è¶³çƒã€æœºæ¢°ã€è®¾è®¡ï¼‰ã€‚
   - æ„ä¹‰ï¼šè¿™æ˜¯æ„¿æ„èŠ±é’±å’Œæ—¶é—´å»æŠ•å…¥çš„å…·ä½“é¢†åŸŸã€‚

ã€Step 3ï¼šç»„åˆâ€œäººç”Ÿå…¬å¼â€ï¼ˆé€ å¥ï¼‰ã€‘
- ä»ä¸Šè¿°ä¸‰ä¸ªåœˆä¸­ï¼Œå„é€‰å‡º 1 ä¸ªæœ€æ ¸å¿ƒã€æœ€åŒ¹é…çš„è¯ã€‚
- å¡«å…¥å…¬å¼ï¼š "æˆ‘æƒ³åœ¨ã€PASSIONã€‘çš„é¢†åŸŸï¼Œåˆ©ç”¨æˆ‘çš„ã€TALENTSã€‘ï¼Œå»å®ç°ã€VALUESã€‘ã€‚"
- ç¡®ä¿å¥å­é€šé¡ºï¼Œé€»è¾‘è‡ªæ´½ã€‚

ã€Step 4ï¼šå»ç°å®ä¸­å¯»æ‰¾â€œè½½ä½“â€ï¼ˆåŒ¹é…å·¥ä½œï¼‰ã€‘
- åŸºäºStep 3é€ å‡ºçš„å¥å­ï¼Œå¯»æ‰¾ç°å®ä¸­å¯¹åº”çš„èŒä¸šã€‚
- æ¨è 3 ä¸ªåŒ¹é…çš„ç°æœ‰èŒä¸šï¼Œæˆ–è€…å»ºè®®åˆ›é€ ä¸€ä¸ªæ–°èŒä¸šã€‚
- è§£é‡Šä¸ºä»€ä¹ˆè¿™äº›èŒä¸šç¬¦åˆå…¬å¼ã€‚

ã€è¾“å‡ºæ ¼å¼ (JSON)ã€‘
{
  "keywords": {
    "values": ["è¯1", "è¯2", "è¯3"],
    "talents": ["è¯1", "è¯2", "è¯3"],
    "passion": ["è¯1", "è¯2", "è¯3"]
  },
  "formula": {
    "passion_word": "é€‰ä¸­çš„çƒ­æƒ…è¯",
    "talent_word": "é€‰ä¸­çš„æ‰èƒ½è¯",
    "value_word": "é€‰ä¸­çš„ä»·å€¼è§‚è¯"
  },
  "advice": "Step 4 çš„èŒä¸šæ¨èå’Œè¯¦ç»†è§£æï¼ˆStringæ ¼å¼ï¼Œæ”¯æŒæ¢è¡Œï¼‰"
}
`;

            try {
                const format = (id) => chapters.find(c => c.id === id).questions
                    .map((item, i) => `ã€Q: ${item.q}ã€‘\nAnswer: ${userAnswers[id][i] || "ç©º"}`)
                    .join("\n\n");

                const userContent = `
                NAME: ${userName}
                === PART 1: VALUES ===
                ${format('values')}
                === PART 2: TALENTS ===
                ${format('talents')}
                === PART 3: PASSION ===
                ${format('passion')}
                `;

                const finalPayload = {
                    name: userName,
                    instruction: analysisInstruction,
                    user_content: userContent
                };

                let responseData = null;
                
                // å°è¯•è°ƒç”¨ V2 åˆ†ææ¥å£
                try {
                    const res = await fetch(API_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ action: 'analyze_v2', data: finalPayload })
                    });
                    if(res.ok) {
                        responseData = (await res.json()).data;
                    }
                } catch(e) {}

                // é™çº§å¤„ç† (V1 åˆ†ææ¥å£)
                if (!responseData) {
                    const fallbackPayload = {
                        name: userName,
                        answers: {
                            values: `[SYSTEM INSTRUCTION: ${analysisInstruction}]\n\n` + format('values'),
                            talents: format('talents'),
                            passion: format('passion')
                        }
                    };
                    const res2 = await fetch(API_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ action: 'analyze', data: fallbackPayload })
                    });
                    responseData = (await res2.json()).data;
                }

                if(responseData) {
                    showResult(responseData);
                } else {
                    throw new Error("No data");
                }

            } catch (e) {
                console.error(e);
                alert("åˆ†æé‡åˆ°ç‚¹å°é—®é¢˜ï¼Œæ­£åœ¨é‡è¯•æ½œæ„è¯†è¿æ¥...");
                setTimeout(() => location.reload(), 2000);
            }
        }

        function showResult(data) {
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('res-name').innerText = userName;

            // å¡«å……å…³é”®è¯
            const kw = data.keywords || {};
            document.getElementById('kw-values').innerText = (kw.values || []).join(" / ");
            document.getElementById('kw-talents').innerText = (kw.talents || []).join(" / ");
            document.getElementById('kw-passion').innerText = (kw.passion || []).join(" / ");

            // å¡«å……å…¬å¼
            const formula = data.formula || {
                passion_word: (kw.passion || ["?"])[0],
                talent_word: (kw.talents || ["?"])[0],
                value_word: (kw.values || ["?"])[0]
            };
            document.getElementById('f-passion').innerText = formula.passion_word;
            document.getElementById('f-talent').innerText = formula.talent_word;
            document.getElementById('f-value').innerText = formula.value_word;

            // å¡«å……å»ºè®®
            document.getElementById('res-advice').innerText = data.advice || data.analysis.final_advice;
        }
    </script>
</body>
</html>
